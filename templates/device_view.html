<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ device[1] }}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .hidden {
            display: none;
        }

        .loader {
            border-top-color: transparent;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .active-tab {
            background-color: #3b82f6 !important;
        }

        .inactive-tab {
            background-color: #4b5563 !important;
        }
    </style>
</head>

<body class="bg-gray-900 min-h-screen flex flex-col">

    <!-- Navigation Bar -->
    <nav class="bg-gradient-to-r from-purple-800 to-indigo-900 shadow-lg p-4 flex justify-between items-center">
        <div class="text-lg font-semibold text-white">IoT-InQube Dashboard</div>
        <button id="logout-btn" class="bg-red-600 text-white px-4 py-2 rounded">Logout</button>
    </nav>

    <!-- Main Content -->
    <div class="flex flex-grow">
        <main class="flex-grow p-4 md:p-8">
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h1 id="device-name" class="text-3xl font-semibold text-gray-200 mb-4">{{ device[1] }}</h1>
                <p id="device-details" class="text-gray-400 mb-8">{{ device[0] }}<br>{{ device[2] }}<br>{{ device[3] }}</p>
            </div>

            <!-- Device Management Section -->
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg mt-6">
                <h2 class="text-2xl font-semibold mb-4 text-white">Device Management</h2>
                <nav class="flex space-x-4 mb-4">
                    <button id="alerts-tab" class="bg-blue-500 text-white px-4 py-2 rounded active-tab">Alerts</button>
                    <button id="notifications-tab" class="bg-gray-700 text-white px-4 py-2 rounded inactive-tab">Notifications</button>
                    <button id="all-device-data-tab" class="bg-gray-700 text-white px-4 py-2 rounded inactive-tab">All Device Data</button>
                </nav>

                <!-- Alerts Content -->
                <div id="alerts-content">
                    <h3 class="text-xl font-semibold mb-2 text-white">Create Alert</h3>
                    <form id="alert-form">
                        <div class="mb-4">
                            <label for="alert-name" class="block text-gray-400">Alert Name</label>
                            <input type="text" id="alert-name" class="w-full px-3 py-2 border rounded-lg" required>
                        </div>
                        <div class="mb-4">
                            <label for="alert-parameter" class="block text-gray-400">Parameter</label>
                            <select id="alert-parameter" class="w-full px-3 py-2 border rounded-lg" required></select>
                        </div>
                        <div class="mb-4">
                            <label for="alert-value" class="block text-gray-400">Value</label>
                            <input type="number" id="alert-value" class="w-full px-3 py-2 border rounded-lg" required>
                        </div>
                        <button type="button" class="bg-blue-500 text-white px-4 py-2 rounded">Create Alert</button>
                    </form>
                </div>

                <!-- Notifications Content -->
                <div id="notifications-content" class="hidden">
                    <h3 class="text-xl font-semibold mb-2 text-white">Notifications</h3>
                    <ul id="notifications-list" class="space-y-2 text-white"></ul>
                </div>

                <!-- All Device Data Content -->
                <div id="all-device-data-content" class="hidden">
                    <h3 class="text-xl font-semibold mb-2 text-white">All Device Data</h3>
                    <table class="table-auto w-full text-white">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Timestamp</th>
                                <th class="px-4 py-2">Data</th>
                            </tr>
                        </thead>
                        <tbody id="all-device-data-list"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Tab switching logic
        document.getElementById('alerts-tab').addEventListener('click', function () {
            switchTab('alerts');
        });

        document.getElementById('notifications-tab').addEventListener('click', function () {
            switchTab('notifications');
        });

        document.getElementById('all-device-data-tab').addEventListener('click', function () {
            switchTab('all-device-data');
            fetchAllDeviceData();
        });

        function switchTab(tab) {
            const tabs = ['alerts', 'notifications', 'all-device-data'];
            tabs.forEach(t => {
                document.getElementById(`${t}-tab`).classList.remove('active-tab');
                document.getElementById(`${t}-tab`).classList.add('inactive-tab');
                document.getElementById(`${t}-content`).classList.add('hidden');
            });
            document.getElementById(`${tab}-tab`).classList.add('active-tab');
            document.getElementById(`${tab}-tab`).classList.remove('inactive-tab');
            document.getElementById(`${tab}-content`).classList.remove('hidden');
        }

        function fetchAllDeviceData() {
            const deviceId = "{{ device[0] }}";
            fetch(`/get-all-device-data/${deviceId}`)
                .then(response => response.json())
                .then(data => {
                    const list = document.getElementById('all-device-data-list');
                    list.innerHTML = '';
                    data.records.forEach(record => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="border px-4 py-2">${new Date(record.timestamp).toLocaleString()}</td>
                            <td class="border px-4 py-2">${JSON.stringify(record.data)}</td>
                        `;
                        list.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching device data:', error));
        }
    </script>
</body>

</html>
